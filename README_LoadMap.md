# 🐾 猫ちゃんアプリ開発ロードマップ（再構築版 - Riverpod & ログイン強化版）🐾

## フェーズ１：基盤構築と認証機能

### 環境構築

- [x] Node.js のインストール (済)
- [x] npm (Node Package Manager) の確認 (Node.jsと一緒にインストールされているはず！) (済)
- [x] VSCode のインストール (済)
- [x] SQLite のインストール (済)
- [x] sqlite3 コマンドが使えるようにパスを設定 (済)
- [x] Node.js プロジェクトの作成 (npm init -y)
- [x] Express のインストール (npm install express body-parser sqlite3 bcrypt express-session cookie-parser)

### サーバーサイド (Node.js + Express + SQLite) - 認証機能

- [x] データベースの設計 (ユーザーテーブル: id, email, password, auth_provider など)
- [x] データベース接続と操作のコード実装 (SQLiteに接続する設定)
- [x] API エンドポイントの実装
  - [x] ユーザー登録 (/register): メールアドレス、パスワードを受け取り、ハッシュ化して保存
  - [x] ログイン (/login): メールアドレスとパスワードを受け取り、認証し、セッションIDを発行 (Bearer Token + JWT) (済)
  - [x] ログアウト (/logout): セッションを破棄
  - [x] 認証が必要なAPIへのアクセス制御ミドルウェアの実装
  - [x] セッション管理の実装 (Bearer Token + JWT)
  - [x] セキュリティ対策 (パスワードのハッシュ化 - bcrypt など)
  - [ ] **【重要】パスワードハッシュ化の修正 (`loginUser`関数)**
    - [ ] `loginUser`関数で、ユーザーが入力したパスワードをハッシュ化してDBのハッシュ値と比較している部分を、正しく比較するロジックに修正する。
  - [ ] **【必須】入力値バリデーションの導入 (`express-validator`)**
    - [ ] `auth.ts`にある`if (!mail || !password)`などの手動バリデーションを削除。
    - [ ] `express-validator`を使って、メールアドレス形式、パスワード必須、文字数制限などをミドルウェアとして実装。
    - [ ] `loginUser`と`registerUser`に適用し、バリデーションエラーをハンドリング。
  - [ ] **【推奨】メールアドレス重複チェックのミドルウェア化**
    - [ ] `registerUser`関数内のメールアドレス重複チェックを、独立したミドルウェアに切り出す。
    - [ ] `auth.ts`からDBへの直接的な重複チェックをなくす。
  - [ ] **【必須】共通エラーハンドリングミドルウェアの導入** 👈 ここね！
    - これを導入すると、エラー処理が一元化されてまじで楽になる！
  - [ ] **【必須】各APIの入力値バリデーション** 👈 ここね！
    - 特に猫情報の登録や更新など、データを受け取るAPIには必須！
  - [ ] **【必須】ファイルアップロード処理とバリデーション** 👈 ここね！
    - 画像を扱うなら絶対必要！
  - [ ] **【推奨】リソースアクセス権限チェック** 👈 ここね！
    - データのセキュリティと整合性を保つために、まじで重要！

### フロントエンド (Flutter) - 認証関連UIとAPI連携

- [x] Flutter プロジェクトの作成 (flutter create cat_app)
- [ ] 必要なパッケージのインストール (riverpod, http, shared_preferences, flutter_hooks)
- [x] UI デザインと実装
  - [x] ログイン・新規登録ページ (シンプルなメールアドレスとパスワード入力フォーム + アカウント作成ボタン)
    - [ ] 入力項目のバリデーション実装 (メールアドレス形式、パスワードの最低文字数など)
- [x] API クライアントの実装 (サーバーの登録・ログインAPIを呼び出す関数)
- [x] 状態管理の実装 (Riverpod を使用してログイン状態などを管理)
- [ ] ログイン状態の永続化 (アプリ再起動後もログイン状態を維持 - shared_preferences など)

## フェーズ２：基本機能の実装とUIデザイン

### フロントエンド (Flutter) - 主要ページのUIデザインと基本的な機能実装

- [ ] UI デザインと実装
  - [ ] **ログイン画面:**
    - [ ] ログイン機能 (メールアドレス、パスワード入力、ログイン処理)
    - [ ] アカウント作成画面への遷移機能
    - [ ] パスワード再発行画面への遷移機能
  - [ ] **アカウント登録画面:**
    - [ ] メールアドレス入力機能
    - [ ] パスワード入力機能
    - [ ] パスワード確認入力機能
    - [ ] アカウント作成機能
    - [ ] ログイン画面への遷移機能
    - [ ] 各入力項目のバリデーション機能
  - [ ] **パスワード再発行画面:**
    - [ ] 登録済みメールアドレス入力機能
    - [ ] パスワード再発行リクエスト機能
    - [ ] (必要に応じて) 新しいパスワード入力機能 (メール認証後など)
    - [ ] ログイン画面への遷移機能
    - [ ] メールアドレスのバリデーション機能
  - [ ] **トップページ (主要機能への導線):**
    - [ ] 各機能への画像ボタン配置（おいおい追加）
  - [x] **マイページ:**
    - [ ] プロフィール表示（簡単な情報）
    - [x] ログアウト機能
    - [ ] パスワード変更機能
    - [ ] アカウント名変更機能
    - [ ] 自分の猫のメイン画像表示 (API連携でランダム表示)
  - [ ] 成長記録＆健康管理ページ (データ入力フォームと表示)
  - [ ] 猫友SNSページ (投稿リスト表示、簡単な投稿フォーム)
  - [ ] 猫グッズ発見＆レビューページ (グッズリスト表示)
  - [ ] 迷子猫捜索協力ページ (情報登録フォームとリスト表示)
- [ ] API クライアントの実装 (各機能に必要なAPIを呼び出す関数)
- [ ] 状態管理の実装 (Riverpod を使用して各ページのデータを管理)
- [ ] データの表示と操作の実装 (APIから取得したデータをUIに表示、ユーザー操作に応じてAPIを呼び出す)

### サーバーサイド (Node.js + Express + SQLite) - 各機能のAPI実装

- [ ] データベースの設計 (猫情報テーブル、投稿テーブル、グッズ情報テーブルなど)
- [ ] データベース接続と操作のコード実装 (各テーブルへのCRUD処理)
- [ ] API エンドポイントの実装 (各機能に必要なAPI)
  - [x] 猫情報の登録 (/cats/register) (認証必須) (済)
  - [ ] 猫情報の取得・更新・削除
  - [ ] 投稿の作成・取得・表示
  - [ ] グッズ情報の取得
  - [ ] 迷子猫情報の登録・取得
  - [ ] **【必須】猫情報登録/更新時の入力値バリデーション (`express-validator`)** 👈 ここもね！
    - `猫情報の登録 (/cats/register)` のAPIも、ユーザーが入力する猫の名前、猫種、毛色などのデータに対して、必須チェック、文字数制限、形式チェック（例: 年齢が数値か、特定の範囲内か）を行う必要があるよ。これをミドルウェアで実装することで、コントローラーは「バリデーション済みの猫情報を受け取ってDBに保存するだけ」になるよ。
  - [ ] **【必須】ファイルアップロード処理とバリデーション** 👈 そしてここ！
    - 猫の画像アップロード機能は、Express単体ではなく`multer`のようなミドルウェアを使うのが一般的だよ。これを使うことで、ファイルサイズの制限、許可するファイル形式（JPEG/PNGのみなど）のチェックをミドルウェア層で行えるよ。
  - [ ] **【推奨】リソースアクセス権限チェックミドルウェア** 👈 最後はここだよ！
    - 「猫情報の取得・更新・削除」や「投稿の作成・取得・表示」など、**「このユーザーがこの猫情報や投稿を操作していいのか？」**という認可（権限）のチェックが必要になるよね。例えば、自分の猫の情報だけを更新できるようにするとか。これを個々のコントローラー内でゴチャゴチャ書く代わりに、専用のミドルウェアとして実装する。

## フェーズ３：統合とテスト

- [ ] フロントエンドとバックエンドを連携させる (APIクライアントを使って通信)
- [ ] 各機能の動作テスト (実際にアプリを動かして確認)
- [ ] UI/UX のテスト (使いやすさ、見た目の確認)

## フェーズ４：デプロイ (最終目標)

- [ ] サーバーサイドのデプロイ方法を検討 (例: VPS, PaaS)
- [ ] Flutter アプリのビルドとストアへの申請方法を検討 (iOS, Android)
